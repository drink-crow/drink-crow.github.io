<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"drink-crow.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="drink-crow Blog">
<meta property="og:url" content="https://drink-crow.github.io/page/2/index.html">
<meta property="og:site_name" content="drink-crow Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="drink-crow">
<meta property="article:tag" content="blog programing">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://drink-crow.github.io/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>drink-crow Blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">drink-crow Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">苟日新 日日新 又日新</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="drink-crow"
      src="/images/favicon.ico">
  <p class="site-author-name" itemprop="name">drink-crow</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/drink-crow" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;drink-crow" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:weibaoziisthebest@outlook.com" title="E-Mail → mailto:weibaoziisthebest@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drink-crow.github.io/Qt_ModelIndex_typeerase/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="drink-crow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="drink-crow Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Qt_ModelIndex_typeerase/" class="post-title-link" itemprop="url">在Qt的ModelIndex中增加数据擦除</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-07 11:06:00" itemprop="dateCreated datePublished" datetime="2021-04-07T11:06:00+08:00">2021-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programing/" itemprop="url" rel="index"><span itemprop="name">Programing</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">阐述如何使用QVariant等改造QModelIndex和对应的Model/View框架使其获得更好的数据抽象能力</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Model-View-Framework"><a href="#Model-View-Framework" class="headerlink" title="Model/View Framework"></a>Model/View Framework</h2><p>Qt中的<code>QTableWidget</code>、<code>QListWidget</code>、<code>QTreeWidge</code>等背后都是一套常见的<code>Model/View</code>架构用户分离显示和数据。一般的自定义<code>View/Model</code>都可以通过继承<code>QAbstractItemView</code>和<code>QAbstractItemModel</code>来快速实现。</p>
<h2 id="ModelIndex"><a href="#ModelIndex" class="headerlink" title="ModelIndex"></a>ModelIndex</h2><p><code>View/Model</code>中通过<code>ModelIndex</code>来索引，<code>ModelIndex</code>中通过<code>row</code>、<code>col</code>和<code>internalPointer</code>来索引到具体的数据。能够适配到绝大分数据结构。<br>但是也存在很大的问题，就在于<code>internalPointer</code>的类型是一个<code>const void *</code>，会丢失原有类型信息，这就要求<code>internalPointer</code>指向统一中数据结构。但是很多时候是无法把要显示的数据的数据结构都做成同一个虚基类（比如是修改不了的不同的外部连接库的类）。<br>通过传入类型擦除后的数据结构的指针，或者建立一个map表来索引<code>internalPointer</code>到具体的类型信息可以解决一部分问题，但是还有一些致命的问题————无法自动释放<code>internalPointer</code>指向类型擦除数据结构或者即使的清空map表，随着时间的迁移，内存占用会越来越庞大，或者引入了非常复杂的自动释放机制。</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>解决的办法很简单，将<code>internalPointer</code>的类型从<code>const void *</code>替换为<code>QVariant</code>等即可，以<code>QVariant</code>储存类型擦除后的数据结构，不需要修改任何逻辑。<br>不过这样则需要复制下<code>QAbstractItemView</code>、<code>QAbstractItemModel</code>、<code>ModelIndex</code>的源代码，重新构建下应用<code>QVariant</code>的<code>ModelIndex</code>的<code>Model/View</code>框架。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drink-crow.github.io/Compile_Skia/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="drink-crow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="drink-crow Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Compile_Skia/" class="post-title-link" itemprop="url">编译Skia</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-02-22 09:33:00" itemprop="dateCreated datePublished" datetime="2021-02-22T09:33:00+08:00">2021-02-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programing/" itemprop="url" rel="index"><span itemprop="name">Programing</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">记录编译Skia中的方法和顺序</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://skia.org/">Skia官方网站</a></p>
<h2 id="Window-10"><a href="#Window-10" class="headerlink" title="Window 10"></a>Window 10</h2><p>  Python 2.7.8<br>  Window 10 1909 (18363.1379)<br>  Window 10 SDK<br>  VS 2019<br>  LLVM 11.0.0</p>
<ul>
<li>准备Python2，并且设置Python2的优先级高于Python3(在环境变量里Python2的路径比Python3先出现即可)<br>否则会出现depot_tools错误和编译时ICU生成错误</li>
<li>拉取部署工具库<br><code>git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git</code></li>
<li>拉取Skia仓库<br><code>git clone https://skia.googlesource.com/skia.git</code></li>
<li>同步需要的第三方库<br><code>cd skia</code><br><code>python2 tools/git-sync-deps</code></li>
<li>设置VS路径<br>在 bn\BUILDCONFIG.gn 文件中，设置<br><code>win_vc = &lt;VS_Path&gt;</code> 如<br><code>win_vc = &quot;C:/Program Files (x86)/Microsoft Visual Studio/2019/Community/VC&quot;</code></li>
<li>生成编译文件<br>  Skia 编译成静态连接库中，会自动设置 Runtime 为 MT，需要手动设置为 MD<br>  Win 32位编译需要在输出文件夹中将 <code>toolchain.ninja</code> 中 <code>rule command</code> 中所有的<br>  <code>cmd.exe /c  C:/Program Files (x86)/Windows Kits/10/bin/SetEnv.cmd /x86 &amp;&amp;</code><br>  去掉，实际上既没有这个脚本，也不需要这个脚本<ul>
<li>win32 Debug 静态连接 /MDd Angle<br>  <code>bin\gn gen out/Debug --args=&quot;is_debug=true target_cpu=\&quot;x86\&quot; extra_cflags=[\&quot;/MDd\&quot;] clang_win=\&quot;C:/Program Files (x86)/LLVM\&quot; skia_use_angle = true&quot;</code></li>
<li>win32 Release 静态连接 /MD Angle<br>  <code>bin\gn gen out/Release --args=&quot;is_debug=false target_cpu=\&quot;x86\&quot; extra_cflags=[\&quot;/MD\&quot;] clang_win=\&quot;C:/Program Files (x86)/LLVM\&quot; skia_use_angle = true&quot;</code></li>
</ul>
</li>
<li>编译<br><code>ninja -C &lt;outpath&gt;</code></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drink-crow.github.io/Qt_compile/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="drink-crow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="drink-crow Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Qt_compile/" class="post-title-link" itemprop="url">编译Qt</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-02-04 17:21:00" itemprop="dateCreated datePublished" datetime="2021-02-04T17:21:00+08:00">2021-02-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programing/" itemprop="url" rel="index"><span itemprop="name">Programing</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">记录编译Qt的细节</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="成功案例"><a href="#成功案例" class="headerlink" title="成功案例"></a>成功案例</h2><ul>
<li>Qt 6.0.1</li>
<li>Window 10 18363.1316 使用Unicode UTF-8提供全球语言支持</li>
<li>C/C++ Optimizing Compiler Version 19.28.29336 for x86</li>
<li>CMake version 3.19.4    <em><strong>CMake 需要大于3.18.3，否则输出Ninja工程文件时无法同时配置debug和release</strong></em></li>
<li>Python 3.9.1</li>
<li>ruby 2.7.2p137 (2020-10-01 revision 5445e04352) [x64-mingw32]</li>
<li>perl 5, version 32, subversion 1 (v5.32.1) built for MSWin32-x64-multi-thread</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c:\Code\qsrc&gt;configure -opensource -confirm-license -prefix C:\Qt\6.0.1\msvc2019 -debug-and-release</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drink-crow.github.io/Rectangle_Packing_Algorithm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="drink-crow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="drink-crow Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Rectangle_Packing_Algorithm/" class="post-title-link" itemprop="url">二维矩形排样/Rectangle Packing</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-13 16:46:00" itemprop="dateCreated datePublished" datetime="2021-01-13T16:46:00+08:00">2021-01-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Algorithm/" itemprop="url" rel="index"><span itemprop="name">Algorithm</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">研究矩形打包算法</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><em><strong><u>现在的确是没时间研究。先把项目的进度推进了。记录研究过程回过头有时间再看看</u></strong></em></p>
<p>研究的起因在做图形引擎里的文字绘制功能，准备把字符纹理填充到一张、多张纹理，以减少drawcall。搜索了一番，发现事情并不简单，这个关于空间利用效率的算法有很多应用场所————计算机纹理打包，板材切割，集装箱打包货物等等。</p>
<p>简单的搜索了下，用中文基本没搜出啥有用的信息，用的关键字————矩形打包算法、排料算法<br>知网找了写有关的，比较新的论文看了下</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://kns.cnki.net/kcms/detail/detail.aspx?dbcode=CJFD&dbname=CJFDAUTO&filename=DYJE202012011&v=w1jssesbP2jiFm3%25mmd2BrHJJuxe5mFZEgs4YZnsboPjSMgzSr%25mmd2BTqlZ0H%25mmd2Fwwt51KVRCGg">曾晓亮,吴琼,袁旭华.二维矩形件排样问题的自适应多岛遗传算法优化[J].锻压技术,2020,45(12):53-58.</a><br><a href="%E4%BA%8C%E7%BB%B4%E7%9F%A9%E5%BD%A2%E4%BB%B6%E6%8E%92%E6%A0%B7%E9%97%AE%E9%A2%98%E7%9A%84%E8%87%AA%E9%80%82%E5%BA%94%E5%A4%9A%E5%B2%9B%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95%E4%BC%98%E5%8C%96_%E6%9B%BE%E6%99%93%E4%BA%AE.pdf">直接下载</a></li>
</ul>
<p><em><strong><u>中文基本确定只有知网里没看过的文章值得再看看，搜索引擎的不用浪费时间</u></strong></em></p>
<p>英文搜索了下，关键字基本可以锁定在<code>packing</code>、<code>nesting</code>。先找了写有关的页面看了下</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.david-colson.com/2020/03/10/exploring-rect-packing.html">David Colson, Exploring rectangle packing algorithms</a><br> 这篇博文的作者的研究动机和我非常像，打包字符的纹理到同一张贴图中</li>
</ul>
<p><em><strong><u>英文的没怎么细看，随便搜搜看了下，有用的信息不少，可以花时间搜索细看</u></strong></em></p>
<h2 id="一步到胃"><a href="#一步到胃" class="headerlink" title="一步到胃"></a>一步到胃</h2><p>知名的C算法库<a target="_blank" rel="noopener" href="https://github.com/nothings/stb">stb</a>/<code>stb_rect_pack.h</code>，无私奉献的公共领域许可。<br>看了下介绍，效果不太好。不过现在只需要一个大概能用的就行。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drink-crow.github.io/VS_regular_expression/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="drink-crow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="drink-crow Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/VS_regular_expression/" class="post-title-link" itemprop="url">VS中正则表达式使用例子</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-13 16:46:00" itemprop="dateCreated datePublished" datetime="2021-01-13T16:46:00+08:00">2021-01-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-04-07 11:06:00" itemprop="dateModified" datetime="2021-04-07T11:06:00+08:00">2021-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Algorithm/" itemprop="url" rel="index"><span itemprop="name">Algorithm</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">举例了VS中常见的几种正则表达式替换方法</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetFlag\((?&lt;var&gt;.*),(?&lt;value&gt;.*)\)</span><br></pre></td></tr></table></figure>

<p>选择了SetFlag(A,B)中的并以${var}和${value}储存，值得注意的是，无嵌套能力，如果AB的表达式中有逗号，则不能正确的分组</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drink-crow.github.io/Freetype_bitmap_buffer_order/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="drink-crow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="drink-crow Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Freetype_bitmap_buffer_order/" class="post-title-link" itemprop="url">FreeType中bitmap的buffer的数据顺序</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-11 10:16:00" itemprop="dateCreated datePublished" datetime="2021-01-11T10:16:00+08:00">2021-01-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programing/" itemprop="url" rel="index"><span itemprop="name">Programing</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">FreeType的bitmap中，buffer的第一个数据代表左上角，从左到右处理，最后一个数据代表右下角。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>FreeType的bitmap中的数据顺序和屏幕坐标顺序一致，与OpenGL中texture的数据Y轴反转。第一个数据代表左上角，从左到右处理，最后一个数据代表右下角C++  </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drink-crow.github.io/OpenGL_texture_data_order/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="drink-crow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="drink-crow Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/OpenGL_texture_data_order/" class="post-title-link" itemprop="url">OpenGL中Texture数据的顺序</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-11 09:48:00" itemprop="dateCreated datePublished" datetime="2021-01-11T09:48:00+08:00">2021-01-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer-Graphics/" itemprop="url" rel="index"><span itemprop="name">Computer Graphics</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">OpenGL中Texture数据的顺序————典型应用glTexImage2D()中data的第一个数据为左下角UV(0,0)的数据，接下来的数据从左到右处理。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>参考<a target="_blank" rel="noopener" href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glTexImage2D.xhtml">OpenGL4 glTexImage2D</a></p>
<blockquote>
<p>The first element corresponds to the lower left corner of the texture image. Subsequent elements progress left-to-right through the remaining texels in the lowest row of the texture image, and then in successively higher rows of the texture image. The final element corresponds to the upper right corner of the texture image.</p>
</blockquote>
<p>buffer中第一个元素代表左下角，从左到右处理，最后一个元素代表右上角</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drink-crow.github.io/glsl_texture_setting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="drink-crow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="drink-crow Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/glsl_texture_setting/" class="post-title-link" itemprop="url">glsl中texture采样的必需设置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-08 10:44:00" itemprop="dateCreated datePublished" datetime="2021-01-08T10:44:00+08:00">2021-01-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer-Graphics/" itemprop="url" rel="index"><span itemprop="name">Computer Graphics</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">在glsl中使用sampler2D，texture()等采样功能，Texture资源必需经过环绕过滤或者mipmap设置，否则采样会出现问题。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>glsl中设置了贴图采样，代码中设置贴图一般需要以下步骤</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glGenTextures</span>(<span class="number">1</span>, &amp;texture);</span><br><span class="line"><span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, texture);</span><br><span class="line"></span><br><span class="line"><span class="built_in">glTexImage2D</span>(...); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置环绕和过滤设置</span></span><br><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);</span><br><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);</span><br><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);</span><br><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动生成mipmap</span></span><br><span class="line"><span class="comment">//glGenerateMipmap(GL_TEXTURE_2D);</span></span><br></pre></td></tr></table></figure>

<p><code>mipmap</code>和<code>环绕过滤</code>设置至少要有一个，或者<code>glTexImage2D()</code>中设置了mipmap。按照经验，<code>OpenGL</code>，<code>OpenGL ES</code> 中均需要这样设置</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drink-crow.github.io/GLES_attribute_default_location/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="drink-crow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="drink-crow Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/GLES_attribute_default_location/" class="post-title-link" itemprop="url">GLES中attribute中默认位置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-08 10:27:00" itemprop="dateCreated datePublished" datetime="2021-01-08T10:27:00+08:00">2021-01-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer-Graphics/" itemprop="url" rel="index"><span itemprop="name">Computer Graphics</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">不同显卡驱动中GLES中attribute的默认位置不相同，使用glGetAttribLocation()确保glVertexAttribPointer()中参数传入正确的位置</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>gles程序遇到了一个在Windows 10 UHD630 下能正确运行却在 macOS 10.15.7 Iris 645却效果不对的问题。macOS下 OpenGL不能抓帧分析，经过了一番努力才发现了问题所在。</p>
<p>问题在于vertex shader中有好几个attribute, 在glVertexAttribPointer()按照了声明顺序默认了他们的索引。实际上 macOS 下attribute的默认顺序可能是倒过来了。使用了glGetAttribLocation()获取实际索引后，显示效果就正常了。</p>
<p>在GL3+的时候习惯了在vs中加上layout强制布局。在GLES中没有layout这回事，习惯性地沿用了以前做法，没想到真的出了问题</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://drink-crow.github.io/Qt_Overlap_UI_with_Layout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="drink-crow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="drink-crow Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Qt_Overlap_UI_with_Layout/" class="post-title-link" itemprop="url">Qt实现多层布局</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-05 15:50:00" itemprop="dateCreated datePublished" datetime="2021-01-05T15:50:00+08:00">2021-01-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-01-06 14:36:00" itemprop="dateModified" datetime="2021-01-06T14:36:00+08:00">2021-01-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programing/" itemprop="url" rel="index"><span itemprop="name">Programing</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">通过实现一个自定义QLayout, 在Qt中多层自定义布局。类似于QStackLayout，与其不同的是————事件能够转发到第一次遇到的控件(不论在哪一层)，而不是只能转发到最上层的控件。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Question-问题"><a href="#Question-问题" class="headerlink" title="Question / 问题"></a>Question / 问题</h2><p>按照需求，需要在一些底层控件上叠加一些UI。比如底层是CAD的绘制页面或者视频播放页面，上面要放一些Label或者Button。上层需要添加的小空间往往不好直接加在最底层的控件上(底层已经有特殊的布局了)</p>
<h2 id="Search-研究过程"><a href="#Search-研究过程" class="headerlink" title="Search / 研究过程"></a>Search / 研究过程</h2><p>中英文都搜索了不少页面，大多是下面几种方法</p>
<ul>
<li>建立两个控件，最上层设置透明背景，属性设置<code>ToolTip</code>一类来实现<ul>
<li>属性设置的过程很复杂，先后顺序有特定要求</li>
<li>跨平台有问题</li>
</ul>
</li>
<li>利用<code>QGridLayout</code>布局，两个控件按先后顺序添加在同一个格子里</li>
<li>使用<code>QStackLayout</code>。</li>
<li>使用类似与Popup Menu的方法<ul>
<li><code>Popup</code>属性的窗口失去焦点后就会自动隐藏</li>
</ul>
</li>
</ul>
<p>除了特别列出来的问题，这些方法都有一个根本的问题————<u><strong>所有的消息都会被最上层的Widget拦截</strong></u>。例如鼠标指针跨过透明背景点击了底层的控件，消息仍会被最上层的控件拦截。  </p>
<ul>
<li>有些热心的开发者指出可以在最顶层的控件安装事件过滤器和转发器来实现消息可以合理的转发到底层。<ul>
<li>过滤和转发所有的事件会带来巨大的工作量，代码复用性几乎没有</li>
</ul>
</li>
<li>也可以通过直接添加上层控件到父窗口来实现————使用<code>setParent()</code>而不是<code>layout()-&gt;addWidget()</code>。<ul>
<li>没有布局功能，需要在父类实现<code>resizeEvent()</code>和<code>moveEvent()</code>的转发来手动计算布局</li>
<li>工作量也比较大，代码复用性也不好</li>
</ul>
</li>
</ul>
<h2 id="Solution-解决方案"><a href="#Solution-解决方案" class="headerlink" title="Solution / 解决方案"></a>Solution / 解决方案</h2><p>最后Qt的官方文档<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/layout.html">Layout Management</a>给了我启发。示例实现了个Qt没有自带而Java中有的布局<code>CardLayout</code></p>
<blockquote>
<p>The <code>CardLayout</code> class is inspired by the Java layout manager of the same name.</p>
</blockquote>
<p>其中设置子控件geometry部分的代码可以看到</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CardLayout::setGeometry</span><span class="params">(<span class="keyword">const</span> QRect &amp;r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QLayout::<span class="built_in">setGeometry</span>(r);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_items.<span class="built_in">size</span>() == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> w = r.<span class="built_in">width</span>() - (m_items.<span class="built_in">count</span>() - <span class="number">1</span>) * <span class="built_in">spacing</span>();</span><br><span class="line">    <span class="keyword">int</span> h = r.<span class="built_in">height</span>() - (m_items.<span class="built_in">count</span>() - <span class="number">1</span>) * <span class="built_in">spacing</span>();</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; m_items.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        QLayoutItem *o = m_items.<span class="built_in">at</span>(i);</span><br><span class="line">        <span class="function">QRect <span class="title">geom</span><span class="params">(r.x() + i * spacing(), r.y() + i * spacing(), w, h)</span></span>;</span><br><span class="line">        o-&gt;<span class="built_in">setGeometry</span>(geom);</span><br><span class="line">        ++i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中最关键的一句是<code>o-&gt;setGeometry(geom);</code>。这表明<code>Layout</code>的本质是自动设置子控件的大小和位置。而我直接利用Qt原有的布局功能来计算每一层控件的大小和位置，再根据计算的结果来手动设置每个控件的大小的位置。不就能优雅地达到目的了吗。</p>
<p>实现起来比想象中的要更简单。先贴出代码<br><strong>OverlapLayout.h</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QLayout&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QList&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OverlapLayout</span> :</span> <span class="keyword">public</span> QLayout</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">OverlapLayout</span>(QWidget* parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">OverlapLayout</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">    <span class="comment">/// 新增的Item会转发到最后一层layout的addItem()</span></span><br><span class="line">    <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">    <span class="comment">/// &lt;param name=&quot;item&quot;&gt;&lt;/param&gt;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>         <span class="title">addItem</span><span class="params">(QLayoutItem* item)</span>     <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function">QSize        <span class="title">sizeHint</span><span class="params">()</span>               <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function">QSize        <span class="title">minimumSize</span><span class="params">()</span>            <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span>          <span class="title">count</span><span class="params">()</span>                  <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function">QLayoutItem* <span class="title">itemAt</span><span class="params">(<span class="keyword">int</span>)</span>              <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function">QLayoutItem* <span class="title">takeAt</span><span class="params">(<span class="keyword">int</span>)</span>                    <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span>         <span class="title">setGeometry</span><span class="params">(<span class="keyword">const</span> QRect&amp; rect)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">AddLayout</span><span class="params">(QLayout*)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QList&lt;QLayout*&gt; things;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>OverlapLayout.cpp</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;OverlapLayout.h&quot;</span><br><span class="line"></span><br><span class="line">#include &lt;QWidget&gt;</span><br><span class="line"></span><br><span class="line">OverlapLayout::OverlapLayout(QWidget* parent)</span><br><span class="line">    :QLayout(parent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void OverlapLayout::addItem(QLayoutItem* item)</span><br><span class="line">&#123;</span><br><span class="line">    if(!things.empty())</span><br><span class="line">    &#123;</span><br><span class="line">        things.last()-&gt;addItem(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QSize OverlapLayout::sizeHint() const</span><br><span class="line">&#123;</span><br><span class="line">    QSize s(0, 0);</span><br><span class="line">    for (auto e : things)</span><br><span class="line">    &#123;</span><br><span class="line">        s = s.expandedTo(e-&gt;sizeHint());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QSize OverlapLayout::minimumSize() const</span><br><span class="line">&#123;</span><br><span class="line">    QSize s(0, 0);</span><br><span class="line">    for (auto e : things)</span><br><span class="line">    &#123;</span><br><span class="line">        s = s.expandedTo(e-&gt;minimumSize());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int OverlapLayout::count() const</span><br><span class="line">&#123;</span><br><span class="line">    int num = 0;</span><br><span class="line">    for (auto e : things)</span><br><span class="line">    &#123;</span><br><span class="line">        num += e-&gt;count();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QLayoutItem* OverlapLayout::itemAt(int index) const</span><br><span class="line">&#123;</span><br><span class="line">    int num = 0;</span><br><span class="line">    int next = 0;</span><br><span class="line">    for (auto e : things)</span><br><span class="line">    &#123;</span><br><span class="line">        next = num + e-&gt;count();</span><br><span class="line">        if (index &lt; next)</span><br><span class="line">        &#123;</span><br><span class="line">            return e-&gt;itemAt(index - num);</span><br><span class="line">        &#125;</span><br><span class="line">        num = next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return nullptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QLayoutItem* OverlapLayout::takeAt(int index)</span><br><span class="line">&#123;</span><br><span class="line">    invalidate();</span><br><span class="line"></span><br><span class="line">    int num = 0;</span><br><span class="line">    int next = 0;</span><br><span class="line">    for (auto e : things)</span><br><span class="line">    &#123;</span><br><span class="line">        next = num + e-&gt;count();</span><br><span class="line">        if (index &lt; next)</span><br><span class="line">        &#123;</span><br><span class="line">            e-&gt;invalidate();</span><br><span class="line">            return e-&gt;takeAt(index - num);</span><br><span class="line">        &#125;</span><br><span class="line">        num = next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return nullptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void OverlapLayout::setGeometry(const QRect&amp; r)</span><br><span class="line">&#123;</span><br><span class="line">    if (things.size() == 0)</span><br><span class="line">        return;</span><br><span class="line"></span><br><span class="line">    for (auto e : things)</span><br><span class="line">    &#123;</span><br><span class="line">        e-&gt;invalidate();</span><br><span class="line">        e-&gt;setGeometry(r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void OverlapLayout::AddLayout(QLayout* layout)</span><br><span class="line">&#123;</span><br><span class="line">    if(layout)</span><br><span class="line">    &#123;</span><br><span class="line">        invalidate();</span><br><span class="line">        things.append(layout);</span><br><span class="line">        addChildLayout(layout);</span><br><span class="line">        layout-&gt;invalidate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现的思路也非常简单。储存多层<code>QLayout*</code>， 在<code>setGeometry()</code>中直接把整体的<code>QRect</code>传入到每一个层中计算就好。这样就可以优雅的使用添加多层布局和使用Qt中原有的功能。</p>
<h2 id="Usage-使用方法"><a href="#Usage-使用方法" class="headerlink" title="Usage / 使用方法"></a>Usage / 使用方法</h2><p>使用的方法也非常简单。父窗口的<code>layout</code>设置为<code>OverlapLayout</code>对象，把每一层的布局设置好，按顺序使用<code>OverlapLayout::AddLayout()</code>添加到多层布局里就好</p>
<h2 id="Doubts-疑点"><a href="#Doubts-疑点" class="headerlink" title="Doubts / 疑点"></a>Doubts / 疑点</h2><p>目前存在的一个疑问是————如何保证每一层的顺序呢。从官方例子中的<code>CardLayout::setGeometry</code>中看到的表现是，最后设置geometry的<code>QLayoutItem</code>在最上层，在<code>OverlapLayout</code>实际体验中也是如此表现，但是目前还不确定一定会如此</p>
<p>使用中发现和层序有关的问题，在<code>QScrollBar</code>第一次触发hover事件的时候，<code>QScrollBar</code>会提到最上面刷新一下，又回到原来的层次，但是有些控件会被挡住。触发下被挡住的控件将恢复正常，且不再出现异常</p>
<h2 id="Update-1-更新1"><a href="#Update-1-更新1" class="headerlink" title="Update 1 / 更新1"></a>Update 1 / 更新1</h2><p>在使用中发现了控件改变后不能做出有效更新的问题。翻看了<code>QBoxLayout</code>等的源代码后发现里面多处使用到了<code>invalidate()</code>来标记重新计算布局。在源代码中增加其调用后表现正常</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">drink-crow</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>
</html>
